<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Duck Hunt</title>
</head>
<body>
    <div id="score">Punkty: <span id="scoreValue">0</span></div>
    <div id="levelInfo">Poziom: <span id="levelValue">1</span></div>
    <canvas id="plansza" width="1500" height="700"></canvas>
    <div id="indicators">
        <div id="ducksIndicator">Kaczki: <span id="ducksLeft"></span></div>
        <div id="bulletsIndicator">Naboje: <span id="bulletsLeft"></span></div>
    </div>
    <div id="info">
        <p>P - pauza</p>
        <p>M - powrÃ³t do menu</p>
        <p>Trafienie: +10 punktÃ³w</p>
    </div>
    <div id="startScreen">
        <h1>Duck Hunt</h1>
        <button id="startGame">Start</button>
    </div>
    <div id="menu">
        <h2>Wybierz planszÄ™</h2>
        <button id="forestBoard">Las</button>
        <button id="lakeBoard">Jezioro</button>
    </div>
    <div id="pauseScreen">
        <h2>Pauza</h2>
        <button id="resumeGame">WznÃ³w</button>
        <button id="backToMenu">PowrÃ³t do menu</button>
    </div>
    <div id="levelComplete">
        <h2>Poziom ukoÅ„czony!</h2>
        <p>Zdobyte punkty: <span id="levelScore"></span></p>
        <button id="nextLevel">NastÄ™pny poziom</button>
    </div>
    <div id="gameOver">
        <h2>Gratulacje! Gra ukoÅ„czona!</h2>
        <p>Zdobyte punkty: <span id="finalScore"></span></p>
        <button id="backToMenuEnd">PowrÃ³t do menu</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const canvas = document.getElementById('plansza');
        const ctx = canvas.getContext('2d');
        let score = 0;
        let isPaused = false;
        let gameStarted = false;
        let ducks = [];
        let currentBackground = null;
        let currentLevel = 1;
        const levels = [
            { ducksToSpawn: 2, bullets: 3 },
            { ducksToSpawn: 5, bullets: 7 },
            { ducksToSpawn: 7, bullets: 9 },
            { ducksToSpawn: 10, bullets: 13 },
            { ducksToSpawn: 15, bullets: 18 }
        ];
        let ducksToKill = 0;
        let bulletsLeft = 0;
        let ducksKilled = 0;
        let levelCompleted = false;

        // DÅºwiÄ™ki
        const shotSound = new Audio('dzwieki/shot.mp3');
        const hitSound = new Audio('dzwieki/duck_hit.mp3');
        const failureSound = new Audio('dzwieki/game_over.mp3');
        const levelCompleteSound = new Audio('dzwieki/win.mp3');
        const menuMusic = new Audio('dzwieki/intro.mp3');
        menuMusic.loop = true;

        // TÅ‚a plansz
        const tlo = new Image();
        tlo.src = 'obrazy/tlo.png';
        const forestBackground = new Image();
        forestBackground.src = 'obrazy/las.jpg';
        const lakeBackground = new Image();
        lakeBackground.src = 'obrazy/jezioro.png';

        // Obraz kaczki
        const duckImage = new Image();
        duckImage.src = 'obrazy/kaczka.png';

        // Oczekiwanie na zaÅ‚adowanie obrazÃ³w
        let imagesLoaded = 0;
        const totalImages = 4; 
        function checkImagesLoaded() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                $('#startScreen').show();
                drawMenuBackground(); 
            }
        }
        tlo.onload = checkImagesLoaded;
        forestBackground.onload = checkImagesLoaded;
        lakeBackground.onload = checkImagesLoaded;
        duckImage.onload = checkImagesLoaded;
        tlo.onerror = () => console.error('BÅ‚Ä…d Å‚adowania tlo.png');
        forestBackground.onerror = () => console.error('BÅ‚Ä…d Å‚adowania las.jpg');
        lakeBackground.onerror = () => console.error('BÅ‚Ä…d Å‚adowania jezioro.png');
        duckImage.onerror = () => console.error('BÅ‚Ä…d Å‚adowania kaczka.jpg');

        
        function drawMenuBackground() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (tlo.complete && tlo.naturalWidth !== 0) {
                ctx.drawImage(tlo, 0, 0, canvas.width, canvas.height);
            } else {
                ctx.fillStyle = 'gray'; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        class Duck {
            constructor() {
                this.x = canvas.width / 2 - 25;
                this.y = canvas.height / 2; 
                this.speedX = (Math.random() - 0.5) * 3; // PrÄ™dkoÅ›Ä‡ pozioma
                this.speedY = Math.random() * 4 - 2; // PrÄ™dkoÅ›Ä‡ pionowa 
                this.width = 150;
                this.height = 150;
                this.isHit = false;
                this.fallSpeed = 0;
                this.timeSinceLastChange = 0;
            }

            update() {
                if (this.isHit) {
                    this.fallSpeed += 0.5; // Przyspieszenie spadania
                    this.y += this.fallSpeed;
                    if (this.y > canvas.height) {
                        const index = ducks.indexOf(this);
                        if (index > -1) {
                            ducks.splice(index, 1);
                        }
                    }
                } else {
                    this.x += this.speedX;
                    this.y += this.speedY;

                    if (this.x <= 0 || this.x + this.width >= canvas.width) {
                        this.speedX = -this.speedX;
                    }
                    if (this.y <= 0) {
                        this.speedY = -this.speedY;
                    }
                    if (this.y + this.height >= canvas.height) { 
                        this.speedY = -this.speedY;
                    }

                    this.timeSinceLastChange += 1 / 60; //60 FPS
                    if (this.timeSinceLastChange > 2 + Math.random()) {
                        this.speedX = (Math.random() - 0.5) * 3; 
                        this.speedY = Math.random() * 4 - 2;
                        this.timeSinceLastChange = 0;
                    }
                }
            }

            draw() {
                if (duckImage.complete && duckImage.naturalWidth !== 0) {
                    ctx.drawImage(duckImage, this.x, this.y, this.width, this.height);
                } else {
                    ctx.fillStyle = this.isHit ? 'red' : 'brown';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            }

            hit() {
                this.isHit = true;
                this.speedX = 0;
                this.speedY = 0;
                hitSound.play().catch(e => console.error('BÅ‚Ä…d odtwarzania duck_hit.mp3:', e));
            }
        }

        function startGame(background) {
            menuMusic.pause(); 
            currentBackground = background === 'forest' ? forestBackground : lakeBackground;
            gameStarted = true;
            isPaused = false;
            score = 0;
            currentLevel = 1;
            ducks = [];
            levelCompleted = false;
            $('#menu').hide();
            $('#pauseScreen').hide();
            $('#levelComplete').hide();
            $('#gameOver').hide();
            startLevel();
        }

        function startLevel() {
            const levelData = levels[currentLevel - 1];
            ducksToKill = levelData.ducksToSpawn;
            bulletsLeft = levelData.bullets;
            ducksKilled = 0;
            ducks = [];
            levelCompleted = false;
            updateIndicators();
            spawnDucks();
            gameLoop();
        }

        function spawnDucks() {
            if (!isPaused && gameStarted && ducks.length < 5 && ducks.length < ducksToKill - ducksKilled) {
                ducks.push(new Duck());
                setTimeout(spawnDucks, 1000); 
            }
        }

        function updateIndicators() {
            let ducksLeftText = '';
            for (let i = 0; i < ducksToKill; i++) {
                ducksLeftText += i < ducksToKill - ducksKilled ? 'ðŸ¦†' : 'â˜‘';
            }
            $('#ducksLeft').text(ducksLeftText);

            let bulletsLeftText = '';
            for (let i = 0; i < levels[currentLevel - 1].bullets; i++) {
                bulletsLeftText += i < bulletsLeft ? 'ðŸ”«' : 'â¬œ';
            }
            $('#bulletsLeft').text(bulletsLeftText);

            $('#levelValue').text(currentLevel);
            $('#scoreValue').text(score);
        }

        function gameLoop() {
            if (!isPaused && gameStarted) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (currentBackground && currentBackground.complete && currentBackground.naturalWidth !== 0) {
                    ctx.drawImage(currentBackground, 0, 0, canvas.width, canvas.height);
                } else {
                    ctx.fillStyle = currentBackground === forestBackground ? 'green' : 'blue';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                ducks.forEach(duck => {
                    duck.update();
                    duck.draw();
                });

                if (ducksKilled >= ducksToKill && ducks.length === 0 && !levelCompleted) {
                    isPaused = true;
                    levelCompleted = true;
                    levelCompleteSound.play().catch(e => console.error('BÅ‚Ä…d odtwarzania win.mp3:', e));
                    $('#levelScore').text(score);
                    if (currentLevel < levels.length) {
                        $('#levelComplete').show();
                    } else {
                        $('#finalScore').text(score);
                        $('#gameOver').show();
                    }
                }

                requestAnimationFrame(gameLoop);
            }
        }

        $(canvas).on('click', function(e) {
            if (!isPaused && gameStarted && bulletsLeft > 0) {
                bulletsLeft--;
                shotSound.play().catch(e => console.error('BÅ‚Ä…d odtwarzania shot.mp3:', e));

                const rect = canvas.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;

                for (let i = ducks.length - 1; i >= 0; i--) {
                    const duck = ducks[i];
                    if (!duck.isHit && clickX >= duck.x && clickX <= duck.x + duck.width &&
                        clickY >= duck.y && clickY <= duck.y + duck.height) {
                        duck.hit();
                        ducksKilled++;
                        score += 10;
                        break;
                    }
                }

                updateIndicators();

                if (bulletsLeft === 0 && ducksKilled < ducksToKill) {
                    isPaused = true;
                    failureSound.play().catch(e => console.error('BÅ‚Ä…d odtwarzania game_over.mp3:', e));
                    $('#gameOver').show();
                    $('#gameOver').html('<h2>Koniec gry! Brak naboi!</h2><p>Zdobyte punkty: ' + score + '</p><button id="backToMenuEnd">PowrÃ³t do menu</button>');
                }
            }
        });

        $('#startGame').on('click', function() {
            $('#startScreen').hide();
            $('#menu').show();
            drawMenuBackground();
            menuMusic.play().catch(e => console.error('BÅ‚Ä…d odtwarzania intro.mp3:', e));
        });

        // ObsÅ‚uga pauzy i powrotu do menu
        $(document).on('keydown', function(e) {
            const key = e.key.toLowerCase();
            if (key === 'p' && gameStarted) {
                isPaused = !isPaused;
                $('#pauseScreen').toggle(isPaused);
                if (!isPaused) {
                    gameLoop();
                    spawnDucks();
                }
            } else if (key === 'm' && gameStarted) {
                gameStarted = false;
                isPaused = false;
                $('#pauseScreen').hide();
                $('#levelComplete').hide();
                $('#gameOver').hide();
                $('#menu').show();
                ducks = [];
                drawMenuBackground();
                menuMusic.play().catch(e => console.error('BÅ‚Ä…d odtwarzania intro.mp3:', e));
            }
        });

        // ObsÅ‚uga menu
        $('#forestBoard').on('click', function() {
            startGame('forest');
        });

        $('#lakeBoard').on('click', function() {
            startGame('lake');
        });

        $('#resumeGame').on('click', function() {
            isPaused = false;
            $('#pauseScreen').hide();
            gameLoop();
            spawnDucks();
        });

        $('#backToMenu').on('click', function() {
            gameStarted = false;
            isPaused = false;
            $('#pauseScreen').hide();
            $('#levelComplete').hide();
            $('#gameOver').hide();
            $('#menu').show();
            ducks = [];
            drawMenuBackground();
            menuMusic.play().catch(e => console.error('BÅ‚Ä…d odtwarzania intro.mp3:', e));
        });

        $('#nextLevel').on('click', function() {
            currentLevel++;
            $('#levelComplete').hide();
            isPaused = false;
            startLevel();
        });

        $(document).on('click', '#backToMenuEnd', function() {
            gameStarted = false;
            isPaused = false;
            $('#gameOver').hide();
            $('#levelComplete').hide();
            $('#menu').show();
            ducks = [];
            drawMenuBackground();
            menuMusic.play().catch(e => console.error('BÅ‚Ä…d odtwarzania intro.mp3:', e));
        });

        $('#menu').hide();
        $('#pauseScreen').hide();
        $('#levelComplete').hide();
        $('#gameOver').hide();
        $('#startScreen').hide();
    </script>
</body>
</html>